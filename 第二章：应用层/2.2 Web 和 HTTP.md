# 2.2 Web 和 HTTP

## 2.2.1 HTTP 概述

超文本传输协议, 由客户和服务器两个程序实现, 定义了报文的结构和报文交换方式

HTTP使用TCP协议来运输报文

客户是向它的套接字接口发送请求报文, 向它的套接字接口接受响应报文, 后面的不归http管了, 归tcp管(分层的好处); 服务器同理

HTTP是一个无状态协议, 服务器不会保存请求报文

## 2.2.2 非持续连接和持续连接

### 非持续连接

对每个请求或响应都单独开一个tcp连接通道

在http1.0采用这种, 但缺点明显:

1. 耗时间, 应为tcp连接时要"三次握手"
2. 加重服务器的负担

### 持续连接

对多个请求个响应经过一个相同的tcp通道

比如一个html有10张jpg, 只需一个tcp通道

会对tcp连接设置超时时间, 若超过, http服务器会关闭连接

## 2.2.3 HTTP报文格式

### 请求报文

```
请求行
首部头(请求头)
\r\n
实体体(请求体或请求实体)
```

```
GET baidu.com HTTP/1.1
Host: baidu.com
Accept-language: fr
\r\n

```

请求行包括: 请求方法(GET, POST, HEAD(用于测试, 只返回http报文), PUT(向服务器提交对象), DELETE(删除服务器的对象)) \+ 请求地址 \+ http版本

### 响应报文

```
状态行
首部头(响应头)
\r\n
实体体(响应体)
```

```
HTTP/1.1 200 OK
Date: ---
Server: ---
Last-Modified: ---
Content-Length: ---
Content-Type: text/html
\r\n

(data data ---)
```

Content-Type: text/html 很重要, 实体的类型

## 2.2.4 cookie

允许站点对用户进行跟踪, 如自动登录等

cookie 有四个组件:

1. 响应报文的一个cookie首部
2. 请求报文的一个cookie首部
3. 在用户端有一个cookie文件, 浏览器进行管理
4. 位于Web站点的一个后端数据库

## 2.2.5 Web缓存

代理服务器

简单来说, 当浏览器向一个Web网站发送请求时, 先发送到代理服务器上, 如果代理服务器有副本, 则直接从代理服务器发送响应报文, 若没有, 则由代理服务器向Web服务器发送请求报文, 请求过来的数据在发给浏览器之外会本地储存一份。

好处就是增加了响应速率, 一个请求, 其他人请求相同的信息时会比较快

通过CDN(内容分发网络), 代理服务器起着重要作用

条件GET

过一段时间后, 浏览器再次向代理服务器发送请求时, 代理服务器会向Web服务器发送一个条件GET请求(首部包含: If-modified-since: (内容是last-modified的值)), 如果内容没有修改, Web服务器直接发送一个没有响应体的响应报文(304, Not Modified)

## 2.2.6 http2.0

主要目标是减小用户感知时延

在http1.1时, 会开多个并行tcp连接来减小时延(防止队首阻塞), 那么http2.0就要减少这种并行tcp并且不会造成阻塞

技术:

1. 成帧: 将每个报文分成小帧, 在同一个tcp连接上交错发送请求和响应报文。好处是把一个大对象分解成许多个小帧，与其他小对象进行交错发送，这样小对象就不必等大对象传输完成后再传输

2. 响应报文的优先次序：可以给每个帧设置权重，权重大的先发送

3. 服务器推：允许一次请求多次响应